(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{920:function(e,t,n){Promise.resolve().then(n.bind(n,6544))},6544:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var s=n(7437),a=n(2265),r=n(9376);function l(e){let{displayName:t}=e;return(0,s.jsx)("div",{className:"header",children:(0,s.jsxs)("h1",{className:"welcome",children:["Welcome, ",(0,s.jsx)("span",{children:t}),"!"]})})}var i=n(2834),c=n(4086);function o(e){let{rows:t,loading:n,error:a}=e;return(0,s.jsx)("section",{className:"investments-shell",children:(0,s.jsxs)("div",{className:"investments-table",children:[(0,s.jsx)("h2",{children:"Your Investments"}),n?(0,s.jsx)("div",{className:"loading",children:"Loading your investments..."}):a?(0,s.jsx)("p",{className:"error centered-text",children:a}):t.length?(0,s.jsx)("div",{className:"table-scroll",children:(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Date"}),(0,s.jsx)("th",{children:"Type"}),(0,s.jsx)("th",{children:"BTC Amount"}),(0,s.jsx)("th",{children:"".concat("€"," Invested")}),(0,s.jsx)("th",{children:"Purchase Price"}),(0,s.jsx)("th",{children:"Current Value"}),(0,s.jsx)("th",{children:"Profit/Loss"}),(0,s.jsx)("th",{children:"Notes"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>{let n=e.profitLoss>=0?"+":"";return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.date}),(0,s.jsx)("td",{children:e.type}),(0,s.jsx)("td",{children:"".concat((0,c.jl)(e.btcAmount)," BTC")}),(0,s.jsx)("td",{children:"".concat((0,c.fr)(e.eurAmount)," ").concat("€")}),(0,s.jsx)("td",{children:"".concat((0,c.fr)(e.purchasePrice)," ").concat("€")}),(0,s.jsx)("td",{children:"".concat((0,c.fr)(e.currentValue)," ").concat("€")}),(0,s.jsx)("td",{className:e.profitLoss>=0?"positive":"negative",children:"".concat(n).concat((0,c.fr)(e.profitLoss)," ").concat("€")}),(0,s.jsx)("td",{children:e.notes})]},"".concat(e.date,"-").concat(t))})})]})}):(0,s.jsx)("p",{className:"muted centered-text",children:"No investments yet."})]})})}var u=n(1559);function d(e){var t;let{totals:n}=e,a=e=>n&&null!=e?"".concat((0,c.fr)(e)," €"):"-- €",r=n?n.totalProfitLoss:0,l=r>=0?"+":"",i=n?"".concat((0,c.jl)(n.totalBTC)," BTC"):"-- BTC",o=null!==(t=null==n?void 0:n.onboardedDate)&&void 0!==t?t:"--";return(0,s.jsxs)("div",{className:"stats-grid",children:[(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Btc hodled"}),(0,s.jsx)("div",{className:"stat-value",children:i})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Current Value"}),(0,s.jsx)("div",{className:"stat-value",children:a(null==n?void 0:n.totalCurrentValue)})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Total Invested"}),(0,s.jsx)("div",{className:"stat-value",children:a(null==n?void 0:n.totalInvested)})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Average Purchase Price"}),(0,s.jsx)("div",{className:"stat-value",children:a(null==n?void 0:n.averagePurchasePrice)})]}),(0,s.jsxs)("div",{className:"stat-card highlight",children:[(0,s.jsx)("div",{className:"stat-label",children:"Final Value"}),(0,s.jsx)("div",{className:"stat-value highlight-value",children:a(null==n?void 0:n.totalFinalValue)})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Result"}),(0,s.jsx)("div",{className:"stat-value ".concat(r>=0?"positive":"negative"),children:n?"".concat(l).concat((0,c.fr)(r)," €"):"-- €"})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Total Taxes"}),(0,s.jsx)("div",{className:"stat-value",children:a(null==n?void 0:n.totalTaxes)})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-label",children:"Onboarded"}),(0,s.jsx)("div",{className:"stat-value",children:o})]})]})}var h=n(8734),m=n(1211),v=n(71),f=n(8705);function x(e){if(null==e)return 0;let t="string"==typeof e?Number(e):e;return Number.isFinite(t)?t:0}function j(){let e=(0,r.useRouter)(),{session:t,user:n,loading:c}=(0,h.a)(),{price:j}=(0,m.k)(),{member:g,investments:N,loading:p,error:b,refresh:w}=function(e){let[t,n]=(0,a.useState)(null),[s,r]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{if(!(null==e?void 0:e.email)){n(null),r([]),i(!1),o(null);return}i(!0);try{let t=await (0,v.jS)(e.email);if(!t){o("Could not find your account. Contact the administrator."),n(null),r([]),i(!1);return}let s=await (0,v.TI)(t.member_id);n(t),r(s),o(null)}catch(e){o(e instanceof Error?e.message:"Error loading investments."),n(null),r([])}finally{i(!1)}},[e]);return(0,a.useEffect)(()=>{let e=!0;return(async()=>{e&&await u()})(),()=>{e=!1}},[u]),{member:t,investments:s,loading:l,error:c,refresh:u}}(n);(0,a.useEffect)(()=>{c||t||e.replace("/")},[c,t,e]),(0,a.useEffect)(()=>{if(!t)return;let e=setInterval(w,6e4);return()=>clearInterval(e)},[t,w]);let _=(0,a.useMemo)(()=>N.length&&j?function(e,t){let n=0,s=0,a=0,r=0,l=null;e.forEach(e=>{let i=x(e.btc_amount),c=x(e.eur_amount),o=i*t*f.HC,u=0,d=o;o>c&&(u=(o-c)*f.n,d=o-u),n+=c,s+=i,a+=d,r+=u,(!l||e.date_swap<l)&&(l=e.date_swap)});let i=s*t*f.HC,c=s>0?n/s:0,o=a-n;return{totalInvested:n,totalBTC:s,averagePurchasePrice:c,totalCurrentValue:i,totalFinalValue:a,totalTaxes:r,totalProfitLoss:o,onboardedDate:l}}(N,j):null,[N,j]),y=(0,a.useMemo)(()=>N.length&&j?N.map(e=>{var t,n;let s=x(e.btc_amount),a=x(e.eur_amount),r=x(e.purchase_price),l=s*j*f.HC;return{date:e.date_swap,type:null!==(t=e.type)&&void 0!==t?t:"-",notes:null!==(n=e.notes)&&void 0!==n?n:"-",btcAmount:s,eurAmount:a,purchasePrice:r,currentValue:l,profitLoss:l-a}}):[],[N,j]);if(c)return(0,s.jsx)("div",{className:"container",children:(0,s.jsx)("div",{className:"loading",children:"Loading..."})});let C=(null==g?void 0:g.display_name)||(null==n?void 0:n.email)||"Investor";return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)(l,{displayName:C}),(0,s.jsx)(d,{totals:_}),(0,s.jsx)(o,{rows:y,loading:p,error:b}),(0,s.jsx)(u.x,{}),(0,s.jsx)(i.$,{})]})}},2834:function(e,t,n){"use strict";n.d(t,{$:function(){return a}});var s=n(7437);function a(){return(0,s.jsxs)("div",{className:"footer",children:[(0,s.jsxs)("p",{children:["\xa9 2026 ",(0,s.jsx)("strong",{children:"D.Inversions"})," - All rights reserved"]}),(0,s.jsxs)("p",{className:"footer-note",children:["Bitcoin Portfolio Tracker | Powered by"," ",(0,s.jsx)("a",{href:"https://www.coingecko.com/es/monedas/bitcoin",target:"_blank",rel:"noreferrer",children:"CoinGecko API"})]})]})}},1559:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var s=n(7437);function a(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"dinversions-logo",children:(0,s.jsx)("img",{src:"/log1.png",alt:"D.Inversions Logo"})}),(0,s.jsx)("div",{className:"btc-logo",children:(0,s.jsx)("img",{src:"https://cryptologos.cc/logos/bitcoin-btc-logo.svg",alt:"Bitcoin Logo"})})]})}},8734:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(2265),a=n(3475);function r(){var e;let[t,n]=(0,s.useState)(null),[r,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=!0;a.O.auth.getSession().then(t=>{var s;let{data:a}=t;e&&(n(null!==(s=a.session)&&void 0!==s?s:null),l(!1))});let{data:t}=a.O.auth.onAuthStateChange((e,t)=>{n(null!=t?t:null)});return()=>{e=!1,t.subscription.unsubscribe()}},[]);let i=(0,s.useCallback)(async(e,t)=>a.O.auth.signInWithPassword({email:e,password:t}),[]),c=(0,s.useCallback)(async()=>a.O.auth.signOut(),[]),o=(0,s.useCallback)(async(e,t)=>{let{data:n}=await a.O.auth.getUser(),s=n.user;if(!(null==s?void 0:s.email))throw Error("No active session. Please log in again.");let{error:r}=await a.O.auth.signInWithPassword({email:s.email,password:e});if(r)throw r;let{error:l}=await a.O.auth.updateUser({password:t});if(l)throw l;sessionStorage.setItem("pw_changed","1"),await a.O.auth.signOut()},[]);return{session:t,user:null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null,loading:r,signIn:i,signOut:c,changePassword:o}}},1211:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});var s=n(2265);async function a(){var e;let t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur");if(!t.ok)throw Error("Failed to fetch BTC price.");let n=await t.json(),s=null==n?void 0:null===(e=n.bitcoin)||void 0===e?void 0:e.eur;if(!s||"number"!=typeof s)throw Error("BTC price data unavailable.");return s}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4,[t,n]=(0,s.useState)(0),[r,l]=(0,s.useState)(!0),[i,c]=(0,s.useState)(null),o=(0,s.useCallback)(async()=>{try{let e=await a();n(e),c(null)}catch(e){c(e instanceof Error?e.message:"Failed to load BTC price.")}finally{l(!1)}},[]);return(0,s.useEffect)(()=>{o();let t=setInterval(o,e);return()=>clearInterval(t)},[o,e]),{price:t,loading:r,error:i,refresh:o}}},8705:function(e,t,n){"use strict";n.d(t,{HC:function(){return r},JA:function(){return a},n:function(){return s}});let s=.21,a=20,r=.99},4086:function(e,t,n){"use strict";n.d(t,{fr:function(){return l},jl:function(){return i},lb:function(){return r}});let s=new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}),a=new Intl.NumberFormat("de-DE",{maximumFractionDigits:0});function r(e){return s.format(e)}function l(e){return a.format(e)}function i(e){return e.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:5})}},71:function(e,t,n){"use strict";n.d(t,{TI:function(){return r},cI:function(){return l},jS:function(){return a}});var s=n(3475);async function a(e){let{data:t,error:n}=await s.O.from("members").select("member_id, display_name, email").eq("email",e).single();if(n)throw n;return t||null}async function r(e){let{data:t,error:n}=await s.O.from("investments").select("*").eq("member_id",e).order("date_swap",{ascending:!0});if(n)throw n;return null!=t?t:[]}async function l(){let{data:e,error:t}=await s.O.rpc("get_portfolio_summary");if(t)throw t;return e||null}},3475:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});var s=n(3053),a=n(257);let r=a.env.NEXT_PUBLIC_SUPABASE_URL,l=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!r||!l)throw Error("Missing Supabase environment variables.");let i=(0,s.eI)(r,l)}},function(e){e.O(0,[383,971,117,744],function(){return e(e.s=920)}),_N_E=e.O()}]);