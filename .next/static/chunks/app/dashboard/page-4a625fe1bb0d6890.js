(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{920:function(e,t,s){Promise.resolve().then(s.bind(s,8762))},8762:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var n=s(7437),a=s(2265),r=s(9376),l=s(8734);function i(e){let{isOpen:t,onClose:s}=e,{changePassword:r}=(0,l.a)(),[i,c]=(0,a.useState)(""),[o,u]=(0,a.useState)(""),[d,h]=(0,a.useState)(""),[m,v]=(0,a.useState)(""),[f,x]=(0,a.useState)(""),[j,g]=(0,a.useState)(!1),p=()=>{c(""),u(""),h(""),v(""),x(""),g(!1)},w=()=>{p(),s()},N=async()=>{if(v(""),x(""),o.length<6){v("Password must be at least 6 characters.");return}if(o!==d){v("Passwords do not match.");return}if(!i){v("Please enter your current password.");return}g(!0);try{await r(i,o),x("Password updated. Logging out...")}catch(e){v(e instanceof Error?e.message:"Unable to update password."),g(!1)}};return t?(0,n.jsx)("div",{className:"modal-overlay open",onClick:e=>e.currentTarget===e.target&&w(),children:(0,n.jsxs)("div",{className:"modal",children:[(0,n.jsx)("h3",{children:"Change Password"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"currentPassword",children:"Current password"}),(0,n.jsx)("input",{type:"password",id:"currentPassword",value:i,onChange:e=>c(e.target.value),placeholder:"Enter current password",autoComplete:"current-password"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"newPassword",children:"New password"}),(0,n.jsx)("input",{type:"password",id:"newPassword",value:o,onChange:e=>u(e.target.value),placeholder:"At least 6 characters",autoComplete:"new-password"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm new password"}),(0,n.jsx)("input",{type:"password",id:"confirmPassword",value:d,onChange:e=>h(e.target.value),placeholder:"Repeat password",autoComplete:"new-password"})]}),m?(0,n.jsx)("div",{className:"error",children:m}):null,f?(0,n.jsx)("div",{className:"info-msg",children:f}):null,(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn-secondary",onClick:w,disabled:j,children:"Cancel"}),(0,n.jsx)("button",{type:"button",onClick:N,disabled:j,children:j?"Saving...":"Save"})]})]})}):null}function c(e){let{onChangePassword:t,onLogout:s}=e,[r,l]=(0,a.useState)(!1),i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=e=>{i.current&&!i.current.contains(e.target)&&l(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,n.jsxs)("div",{className:"settings-wrapper",ref:i,children:[(0,n.jsx)("button",{type:"button",className:"settings-btn",title:"Settings","aria-label":"Settings",onClick:()=>l(e=>!e),children:"⚙️"}),(0,n.jsxs)("div",{className:"settings-dropdown ".concat(r?"open":""),children:[(0,n.jsx)("button",{type:"button",className:"settings-item",onClick:()=>{l(!1),t()},children:"\uD83D\uDD11 Change Password"}),(0,n.jsx)("div",{className:"settings-divider"}),(0,n.jsx)("button",{type:"button",className:"settings-item danger",onClick:()=>{l(!1),s()},children:"\uD83D\uDEAA Logout"})]})]})}function o(e){let{displayName:t,onChangePassword:s,onLogout:a}=e;return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsxs)("h1",{className:"welcome",children:["Welcome, ",(0,n.jsx)("span",{children:t}),"!"]}),(0,n.jsx)(c,{onChangePassword:s,onLogout:a})]})}var u=s(2834),d=s(4086);function h(e){let{rows:t,loading:s,error:a}=e;return s?(0,n.jsxs)("div",{className:"investments-table",children:[(0,n.jsx)("h2",{children:"Your Investments"}),(0,n.jsx)("div",{className:"loading",children:"Loading your investments..."})]}):a?(0,n.jsxs)("div",{className:"investments-table",children:[(0,n.jsx)("h2",{children:"Your Investments"}),(0,n.jsx)("p",{className:"error centered-text",children:a})]}):t.length?(0,n.jsxs)("div",{className:"investments-table",children:[(0,n.jsx)("h2",{children:"Your Investments"}),(0,n.jsx)("div",{className:"table-scroll",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"BTC Amount"}),(0,n.jsx)("th",{children:"€ Invested"}),(0,n.jsx)("th",{children:"Purchase Price"}),(0,n.jsx)("th",{children:"Current Value"}),(0,n.jsx)("th",{children:"Profit/Loss"})]})}),(0,n.jsx)("tbody",{children:t.map((e,t)=>{let s=e.profitLoss>=0?"+":"";return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.date}),(0,n.jsx)("td",{children:"".concat((0,d.jl)(e.btcAmount)," BTC")}),(0,n.jsx)("td",{children:"".concat((0,d.fr)(e.eurAmount)," €")}),(0,n.jsx)("td",{children:"".concat((0,d.fr)(e.purchasePrice)," €")}),(0,n.jsx)("td",{children:"".concat((0,d.fr)(e.currentValue)," €")}),(0,n.jsx)("td",{className:e.profitLoss>=0?"positive":"negative",children:"".concat(s).concat((0,d.fr)(e.profitLoss)," €")})]},"".concat(e.date,"-").concat(t))})})]})})]}):(0,n.jsxs)("div",{className:"investments-table",children:[(0,n.jsx)("h2",{children:"Your Investments"}),(0,n.jsx)("p",{className:"muted centered-text",children:"No investments yet."})]})}var m=s(1559);function v(e){let{totals:t}=e,s=e=>t&&null!=e?"".concat((0,d.fr)(e)," €"):"-- €",a=t?t.totalProfitLoss:0,r=a>=0?"+":"",l=t?"".concat((0,d.jl)(t.totalBTC)," BTC"):"-- BTC";return(0,n.jsxs)("div",{className:"stats-grid",children:[(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-label",children:"Btc hodled"}),(0,n.jsx)("div",{className:"stat-value",children:l})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-label",children:"Current Value"}),(0,n.jsx)("div",{className:"stat-value",children:s(null==t?void 0:t.totalCurrentValue)})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-label",children:"Total Invested"}),(0,n.jsx)("div",{className:"stat-value",children:s(null==t?void 0:t.totalInvested)})]}),(0,n.jsxs)("div",{className:"stat-card highlight",children:[(0,n.jsx)("div",{className:"stat-label",children:"Final Value"}),(0,n.jsx)("div",{className:"stat-value highlight-value",children:s(null==t?void 0:t.totalFinalValue)})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-label",children:"Result"}),(0,n.jsx)("div",{className:"stat-value ".concat(a>=0?"positive":"negative"),children:t?"".concat(r).concat((0,d.fr)(a)," €"):"-- €"})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("div",{className:"stat-label",children:"Total Taxes"}),(0,n.jsx)("div",{className:"stat-value",children:s(null==t?void 0:t.totalTaxes)})]})]})}var f=s(1211),x=s(71),j=s(8705);function g(e){if(null==e)return 0;let t="string"==typeof e?Number(e):e;return Number.isFinite(t)?t:0}function p(){let e=(0,r.useRouter)(),{session:t,user:s,loading:c,signOut:d}=(0,l.a)(),{price:p}=(0,f.k)(),{client:w,investments:N,loading:b,error:C,refresh:y}=function(e){let[t,s]=(0,a.useState)(null),[n,r]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{if(!(null==e?void 0:e.email)){s(null),r([]),i(!1),o(null);return}i(!0);try{let t=await (0,x.Zt)(e.email);if(!t){o("Could not find your account. Contact the administrator."),s(null),r([]),i(!1);return}let n=await (0,x.AW)(t.client_id);s(t),r(n),o(null)}catch(e){o(e instanceof Error?e.message:"Error loading investments."),s(null),r([])}finally{i(!1)}},[e]);return(0,a.useEffect)(()=>{let e=!0;return(async()=>{e&&await u()})(),()=>{e=!1}},[u]),{client:t,investments:n,loading:l,error:c,refresh:u}}(s),[E,P]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c||t||e.replace("/")},[c,t,e]),(0,a.useEffect)(()=>{if(!t)return;let e=setInterval(y,6e4);return()=>clearInterval(e)},[t,y]);let S=(0,a.useMemo)(()=>N.length&&p?function(e,t){let s=0,n=0,a=0,r=0;e.forEach(e=>{let l=g(e.btc_amount),i=g(e.eur_amount),c=l*t*j.HC,o=0,u=c;c>i&&(o=(c-i)*j.n,u=c-o),s+=i,n+=l,a+=u,r+=o});let l=n*t*j.HC,i=a-s;return{totalInvested:s,totalBTC:n,totalCurrentValue:l,totalFinalValue:a,totalTaxes:r,totalProfitLoss:i}}(N,p):null,[N,p]),_=(0,a.useMemo)(()=>N.length&&p?N.map(e=>{let t=g(e.btc_amount),s=g(e.eur_amount),n=g(e.purchase_price),a=t*p*j.HC;return{date:e.date_swap,btcAmount:t,eurAmount:s,purchasePrice:n,currentValue:a,profitLoss:a-s}}):[],[N,p]);if(c)return(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"loading",children:"Loading..."})});let k=(null==w?void 0:w.display_name)||(null==s?void 0:s.email)||"Investor";return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)(o,{displayName:k,onChangePassword:()=>P(!0),onLogout:()=>d()}),(0,n.jsx)(v,{totals:S}),(0,n.jsx)(h,{rows:_,loading:b,error:C}),(0,n.jsx)(i,{isOpen:E,onClose:()=>P(!1)}),(0,n.jsx)(m.x,{}),(0,n.jsx)(u.$,{})]})}},2834:function(e,t,s){"use strict";s.d(t,{$:function(){return a}});var n=s(7437);function a(){return(0,n.jsxs)("div",{className:"footer",children:[(0,n.jsxs)("p",{children:["\xa9 2026 ",(0,n.jsx)("strong",{children:"D.Inversions"})," - All rights reserved"]}),(0,n.jsxs)("p",{className:"footer-note",children:["Bitcoin Portfolio Tracker | Powered by"," ",(0,n.jsx)("a",{href:"https://www.coingecko.com",target:"_blank",rel:"noreferrer",children:"CoinGecko API"})]})]})}},1559:function(e,t,s){"use strict";s.d(t,{x:function(){return a}});var n=s(7437);function a(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"dinversions-logo",children:(0,n.jsx)("img",{src:"/log1.png",alt:"D.Inversions Logo"})}),(0,n.jsx)("div",{className:"btc-logo",children:(0,n.jsx)("img",{src:"https://cryptologos.cc/logos/bitcoin-btc-logo.svg",alt:"Bitcoin Logo"})})]})}},8734:function(e,t,s){"use strict";s.d(t,{a:function(){return r}});var n=s(2265),a=s(3475);function r(){var e;let[t,s]=(0,n.useState)(null),[r,l]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=!0;a.O.auth.getSession().then(t=>{var n;let{data:a}=t;e&&(s(null!==(n=a.session)&&void 0!==n?n:null),l(!1))});let{data:t}=a.O.auth.onAuthStateChange((e,t)=>{s(null!=t?t:null)});return()=>{e=!1,t.subscription.unsubscribe()}},[]);let i=(0,n.useCallback)(async(e,t)=>a.O.auth.signInWithPassword({email:e,password:t}),[]),c=(0,n.useCallback)(async()=>a.O.auth.signOut(),[]),o=(0,n.useCallback)(async(e,t)=>{let{data:s}=await a.O.auth.getUser(),n=s.user;if(!(null==n?void 0:n.email))throw Error("No active session. Please log in again.");let{error:r}=await a.O.auth.signInWithPassword({email:n.email,password:e});if(r)throw r;let{error:l}=await a.O.auth.updateUser({password:t});if(l)throw l;sessionStorage.setItem("pw_changed","1"),await a.O.auth.signOut()},[]);return{session:t,user:null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null,loading:r,signIn:i,signOut:c,changePassword:o}}},1211:function(e,t,s){"use strict";s.d(t,{k:function(){return r}});var n=s(2265);async function a(){var e;let t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur");if(!t.ok)throw Error("Failed to fetch BTC price.");let s=await t.json(),n=null==s?void 0:null===(e=s.bitcoin)||void 0===e?void 0:e.eur;if(!n||"number"!=typeof n)throw Error("BTC price data unavailable.");return n}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4,[t,s]=(0,n.useState)(0),[r,l]=(0,n.useState)(!0),[i,c]=(0,n.useState)(null),o=(0,n.useCallback)(async()=>{try{let e=await a();s(e),c(null)}catch(e){c(e instanceof Error?e.message:"Failed to load BTC price.")}finally{l(!1)}},[]);return(0,n.useEffect)(()=>{o();let t=setInterval(o,e);return()=>clearInterval(t)},[o,e]),{price:t,loading:r,error:i,refresh:o}}},8705:function(e,t,s){"use strict";s.d(t,{HC:function(){return r},JA:function(){return a},n:function(){return n}});let n=.21,a=20,r=.99},4086:function(e,t,s){"use strict";s.d(t,{fr:function(){return l},jl:function(){return i},lb:function(){return r}});let n=new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}),a=new Intl.NumberFormat("de-DE",{maximumFractionDigits:0});function r(e){return n.format(e)}function l(e){return a.format(e)}function i(e){return e.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:5})}},71:function(e,t,s){"use strict";s.d(t,{AW:function(){return r},Zt:function(){return a},cI:function(){return l}});var n=s(3475);async function a(e){let{data:t,error:s}=await n.O.from("clients").select("client_id, display_name, email").eq("email",e).single();if(s)throw s;return t||null}async function r(e){let{data:t,error:s}=await n.O.from("investments").select("*").eq("client_id",e).order("date_swap",{ascending:!0});if(s)throw s;return null!=t?t:[]}async function l(){let{data:e,error:t}=await n.O.rpc("get_portfolio_summary");if(t)throw t;return e||null}},3475:function(e,t,s){"use strict";s.d(t,{O:function(){return i}});var n=s(3053),a=s(257);let r=a.env.NEXT_PUBLIC_SUPABASE_URL,l=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!r||!l)throw Error("Missing Supabase environment variables.");let i=(0,n.eI)(r,l)}},function(e){e.O(0,[383,971,117,744],function(){return e(e.s=920)}),_N_E=e.O()}]);